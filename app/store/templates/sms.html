{% extends "base.html" %}

{% block title %}Consulta de SMS{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('store_bp.static', filename='css/sms.css') }}">
  <meta name="csrf_token" content="{{ csrf_token() }}">
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('store_bp.static', filename='js/sms_configs.js') }}" defer></script>
  <script src="{{ url_for('store_bp.static', filename='js/sms_list.js') }}" defer></script>
  <script src="{{ url_for('store_bp.static', filename='js/sms_numbers.js') }}" defer></script>
  <script src="{{ url_for('store_bp.static', filename='js/twofa_configs.js') }}" defer></script>
{% endblock %}

{% block content %}

<div id="sms-management-container" class="form-container-large">
  <div class="admin-card">
    <div class="d-flex align-items-center flex-wrap gap-1 mb-1 justify-content-between">
      <h2 class="m-0 no-shrink">Consulta de SMS</h2>
      <div>
        <button 
          id="btnVolverPanel" 
          type="button" 
          class="btn-blue"
          data-url="{{ url_for('store_bp.admin_store') }}"
        >
          Volver
        </button>
      </div>
    </div>

    <hr class="hr-margin-15">
    <h3 class="mb-05 text-center">B√∫squeda y Eliminaci√≥n de Correos</h3>
    <form id="searchNumbersForm" name="searchNumbersForm">
      <label for="searchNumbersInput" class="sr-only">Buscar y eliminar correos</label>
      <textarea id="searchNumbersInput" rows="2" class="flex-grow-1 resize-vertical" placeholder="Ingresa uno o varios correos (separados por comas, espacios o saltos de l√≠nea)." autocomplete="off"></textarea>
      <button type="submit" class="btn-search">Limpiar</button>
    </form>
    <div id="numbersSearchResults" class="search-results-container">
        <!-- Resultados aqu√≠ -->
    </div>
    <div class="d-flex justify-content-between align-items-center min-height-2-5rem">
      <div id="searchStatus" class="text-italic text-secondary"></div>
      <div id="delete-displayed-container">
          <button id="deleteDisplayedBtn" class="btn-red btn-small d-none">
              Eliminar X Mostrados
          </button>
      </div>
    </div>
  </div>

  <div class="admin-card">
    <div id="allowedNumbersContainer" class="mb-0">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-1 mb-05">
        <div><strong>Lista Correos permitidos:</strong></div>
        <div class="d-flex align-items-center gap-05">
          <label for="perPageSelectNumbers"><strong>Mostrar:</strong></label>
          <select id="perPageSelectNumbers" class="select-padding-3px" autocomplete="off">
             <option value="10">10</option><option value="20" selected>20</option><option value="30">30</option><option value="50">50</option><option value="100">100</option><option value="300">300</option><option value="-1">Todos</option>
          </select>
        </div>
      </div>
      <div id="allowedNumbersTextContainer" class="allowed-emails-display">
        <p>Cargando correos...</p>
      </div>
      <div id="allowedNumbersPagination" class="d-flex justify-content-between align-items-center">
        <span id="paginationInfoNumbers"></span>
        <button id="deleteAllNumbersBtn" class="btn-panel btn-red btn-sm" title="Eliminar TODOS los correos permitidos">
          <i class="fas fa-trash"></i> Eliminar Todos
        </button>
        <div class="ml-auto">
          <button id="prevPageBtnNumbers" class="btn-panel btn-blue" disabled>&lt; Anterior</button>
          <button id="nextPageBtnNumbers" class="btn-panel btn-blue ml-05" disabled>Siguiente &gt;</button>
        </div>
      </div>
      
      <hr class="hr-margin-15">
      
      <div id="addNumbersSection" class="mb-0">
        <label for="newNumbersInput" class="sr-only">Nuevos Correos</label>
        <textarea id="newNumbersInput" name="new_numbers_input" rows="2" class="d-block mx-auto mt-05 mb-05 textarea-wide" placeholder="Ingresa uno o varios correos (separados por comas, espacios o saltos de l√≠nea). Ejemplo: correo1@gmail.com, correo2@gmail.com..." autocomplete="off"></textarea>
        <div class="text-center">
          <button type="button" id="addNumbersBtn" class="btn-blue">A√±adir Correos</button>
        </div>
        <div class="text-center mt-05">
          <span id="addNumbersMsg" class="text-italic text-success"></span>
        </div>
      </div>
    </div>
  </div>

  <div class="admin-card">
    <!-- Secci√≥n de Configuraci√≥n Android -->
    <div id="android-sms-section" class="mb-2">
      <h4 class="mb-1 text-center">üì± N√∫meros Android</h4>
      <p class="text-center text-secondary mb-1 twofa-description-text">
        Configura m√∫ltiples n√∫meros Android para recibir SMS directamente desde tus celulares usando SMS Forwarder
      </p>
      
      <!-- Formulario para agregar/editar n√∫mero Android -->
      <form id="android-sms-form" class="mb-2">
        <input type="hidden" id="android-config-id" value="">
        <label for="android-config-name" class="sr-only">Nombre</label>
        <input
          type="text"
          id="android-config-name"
          placeholder="Nombre (obligatorio, ej: Mi Celular Principal)"
          required
          class="d-block mb-05 w-100"
          autocomplete="off"
        >
        <label for="android-phone-number" class="sr-only">N√∫mero Android</label>
        <input
          type="text"
          id="android-phone-number"
          placeholder="Tu n√∫mero Android (ej: +573001234567)"
          required
          class="d-block mb-05 w-100"
          autocomplete="off"
          pattern="^\+[1-9]\d{1,14}$"
          title="Formato: +573001234567 (con c√≥digo de pa√≠s)"
        >
        
        <label for="android-api-key" class="sr-only">API Key (Opcional)</label>
        <div class="d-flex align-items-center gap-05 mb-05">
          <div class="flex-grow-1 d-flex align-items-center twofa-api-key-container">
            <input
              type="password"
              id="android-api-key"
              placeholder="API Key (opcional, para mayor seguridad)"
              class="flex-grow-1 twofa-api-key-input"
              autocomplete="off"
            >
            <button 
              type="button" 
              id="toggle-api-key-visibility" 
              class="btn-blue btn-small twofa-api-key-toggle" 
              title="Mostrar/Ocultar API Key"
            >
              <i class="fas fa-eye" id="api-key-eye-icon"></i>
            </button>
          </div>
          <button type="button" id="generate-api-key-btn" class="btn-blue btn-small" title="Generar API Key aleatoria">
            <i class="fas fa-key"></i> Generar
          </button>
        </div>
        
        <div class="text-center">
          <button type="submit" id="android-sms-save-btn" class="btn-green">Agregar N√∫mero Android</button>
          <button type="button" id="android-sms-cancel-btn" class="btn-blue d-none">Cancelar</button>
        </div>
        
        <div id="android-sms-message" class="mt-05 text-center"></div>
      </form>
      
      <!-- Lista de n√∫meros Android configurados (OCULTA - solo se usa el modal de edici√≥n) -->
      <div id="android-configs-list" class="mb-2 d-none">
        <p class="text-center">Cargando n√∫meros Android...</p>
      </div>
      
      <div class="alert-info p-1 mb-1 twofa-instructions-text">
        <strong>üìã Instrucciones para SMS Forwarder:</strong>
        <ol class="mb-0 twofa-instructions-list">
          <li><strong>Agrega el n√∫mero Android:</strong> Ingresa el n√∫mero con c√≥digo de pa√≠s (ej: +573001234567) y guarda</li>
          <li><strong>Copia la URL del webhook:</strong> Haz clic en "Editar" del n√∫mero Android y copia la URL del webhook que aparece</li>
          <li><strong>Abre SMS Forwarder en tu celular:</strong>
            <ul class="twofa-instructions-sublist">
              <li>Ve a "Webhooks" o "HTTP POST"</li>
              <li>Crea un nuevo webhook</li>
              <li>Pega la URL copiada en el campo "URL"</li>
              <li>M√©todo: <strong>POST</strong></li>
              <li>Content-Type: <strong>application/json</strong></li>
            </ul>
          </li>
          <li><strong>Configura el Body JSON:</strong> En el campo "Body" o "JSON Body", pega exactamente esto (reemplaza TU_API_KEY con tu API key si la configuraste):
            <pre class="twofa-code-block"><code>{"from_number": "{in-number}", "to_number": "{out-number}", "message_body": "{msg}", "api_key": "TU_API_KEY"}</code></pre>
            <strong>Nota:</strong> Si no configuraste API key, puedes omitir el campo "api_key" o dejarlo vac√≠o:
            <pre class="twofa-code-block"><code>{"from_number": "{in-number}", "to_number": "{out-number}", "message_body": "{msg}"}</code></pre>
          </li>
          <li><strong>Guarda y activa:</strong> Guarda la configuraci√≥n y activa el webhook en SMS Forwarder</li>
        </ol>
        <p class="mb-0 mt-05 twofa-tip-text">
          <strong>üí° Tip:</strong> Los placeholders <code>{in-number}</code>, <code>{out-number}</code> y <code>{msg}</code> son reemplazados autom√°ticamente por SMS Forwarder con los datos reales del SMS recibido.
        </p>
      </div>
    </div>
    
    <hr class="hr-margin-15">
    
    <!-- Secci√≥n de Gesti√≥n de N√∫meros SMS -->
    <div id="sms-configs-section" class="mb-2">
      <h4 class="mb-1 text-center">Gestionar N√∫meros SMS</h4>
      
      <!-- Formulario para crear configuraci√≥n -->
      <form id="sms-config-form" class="mb-2">
        
        <label for="sms-config-name" class="sr-only">Nombre</label>
        <input
          type="text"
          id="sms-config-name"
          placeholder="Nombre (obligatorio)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <label for="sms-config-account-sid" class="sr-only">Twilio Account SID</label>
        <input
          type="text"
          id="sms-config-account-sid"
          placeholder="Twilio Account SID (obligatorio)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <label for="sms-config-auth-token" class="sr-only">Twilio Auth Token</label>
        <input
          type="password"
          id="sms-config-auth-token"
          placeholder="Twilio Auth Token (obligatorio)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <label for="sms-config-phone" class="sr-only">N√∫mero de Tel√©fono</label>
        <input
          type="text"
          id="sms-config-phone"
          placeholder="N√∫mero de Tel√©fono (obligatorio, ej: +12672441170)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <div class="text-center d-flex gap-05 justify-content-center">
          <button type="submit" id="sms-config-save-btn" class="btn-green">Crear</button>
          <button type="button" id="test-number-states-btn" class="btn-blue">Probar Estado de N√∫meros</button>
        </div>
        
        <div id="sms-config-message" class="mt-05"></div>
      </form>
      
      <!-- Lista de configuraciones existentes -->
      <div id="sms-configs-list" class="mb-2">
        <p class="text-center">Cargando configuraciones...</p>
      </div>
    </div>
    
    <hr class="hr-margin-15">
    
    <div class="mb-1 d-flex gap-05 justify-content-center align-items-center sms-controls-row">
      <select id="sms-number-select" class="sms-select-width" autocomplete="off">
        <option value="">-- Selecciona un n√∫mero --</option>
      </select>
    </div>
    
    <div class="mb-1 d-flex gap-05 justify-content-center align-items-center sms-controls-row">
      <label for="sms-search-input" class="sr-only">Buscar mensajes SMS</label>
      <input 
        type="text" 
        id="sms-search-input" 
        class="sms-input-width" 
        placeholder="Buscar por nombre o dejar vac√≠o para ver todo"
        autocomplete="off"
      >
      <button type="button" id="btn-refresh-messages" class="btn-blue">
        <i class="fas fa-search"></i> Buscar
      </button>
      <button type="button" id="btn-cleanup-sms" class="btn-red" title="Eliminar mensajes antiguos (m√°s de 15 minutos) y hu√©rfanos">
        <i class="fas fa-trash"></i>
      </button>
    </div>
    
    <div id="sms-messages-container" class="mt-3">
      <div class="text-center py-5">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
      </div>
    </div>
  </div>

  <!-- ‚úÖ NUEVO: Secci√≥n de Gesti√≥n de 2FA por Correo -->
  <div class="admin-card twofa-section-card">
    <h4 class="mb-1 text-center">üîê Gesti√≥n de 2FA por Correo</h4>
    
    <!-- Formulario para agregar/editar configuraci√≥n 2FA -->
    <form id="twofa-config-form" class="mb-2">
      <input type="hidden" id="twofa-config-id" value="">
      
      <label for="twofa-emails-input" class="sr-only">Correos</label>
      <textarea
        id="twofa-emails-input"
        rows="2"
        placeholder="Correos (separados por coma o espacio): correo1@test.com, correo2@test.com"
        required
        class="d-block mb-05 w-100"
        autocomplete="off"
      ></textarea>
      
      <!-- L√≠nea compacta: C√≥digo manual | Subir QR | Bot√≥n Agregar -->
      <div class="d-flex gap-05 align-items-center mb-05 twofa-compact-row">
        <label for="twofa-secret-input" class="sr-only">C√≥digo Secreto</label>
        <input
          type="text"
          id="twofa-secret-input"
          placeholder="C√≥digo secreto"
          class="flex-grow-1"
          autocomplete="off"
          pattern="[A-Z0-9]{16,}"
          title="C√≥digo secreto TOTP (solo letras may√∫sculas y n√∫meros)"
        >
        <label for="twofa-qr-file" class="sr-only">Archivo QR</label>
        <input
          type="file"
          id="twofa-qr-file"
          accept="image/*"
          class="d-none"
        >
        <button type="button" id="twofa-upload-qr-btn" class="btn-blue btn-small">
          <i class="fas fa-qrcode"></i> QR
        </button>
        <button type="submit" id="twofa-save-btn" class="btn-green btn-small">Agregar</button>
        <button type="button" id="twofa-cancel-btn" class="btn-blue btn-small d-none">Cancelar</button>
      </div>
      
      <!-- Preview del QR (oculto por defecto) -->
      <div id="twofa-qr-preview" class="text-center mb-05 d-none"></div>
      
      <!-- Display del secreto configurado (oculto por defecto) -->
      <div id="twofa-secret-display" class="d-none mb-05 text-center">
        <strong>Secreto configurado:</strong> <code id="twofa-secret-display-value"></code>
      </div>
      
      <div id="twofa-message" class="mt-05 text-center"></div>
    </form>
    
    <!-- B√∫squeda y Mostrar -->
    <div class="d-flex flex-wrap align-items-center mb-1 productos-buscar-mostrar">
      <div class="search-container">
        <label for="searchTwofaInput" class="sr-only">Buscar configuraciones 2FA</label>
        <input type="search" id="searchTwofaInput" placeholder="Buscar..." autocomplete="off">
      </div>
      <div class="d-flex align-items-center">
        <label for="showTwofaCount" class="sr-only">Mostrar cantidad</label>
        <select id="showTwofaCount" autocomplete="off">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20" selected>20</option>
          <option value="30">30</option>
          <option value="40">40</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="all">Todos</option>
        </select>
      </div>
    </div>
    
    <!-- Lista de configuraciones 2FA -->
    <div id="twofa-configs-list" class="mt-2">
      <p class="text-center text-secondary">Cargando configuraciones...</p>
    </div>
    
    <!-- Botones de paginaci√≥n -->
    <div class="d-flex justify-content-center mt-2 mb-05 pagination-buttons">
      <button id="prevTwofaPageBtn" class="btn-blue btn-panel" type="button">&lt; Anterior</button>
      <button id="nextTwofaPageBtn" class="btn-blue btn-panel" type="button">Siguiente &gt;</button>
    </div>
  </div>
</div>

<!-- Modal para editar configuraci√≥n 2FA -->
<div id="twofa-edit-modal" class="modal d-none" tabindex="-1">
  <div class="sms-modal-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="m-0 text-center flex-grow-1">Editar Configuraci√≥n 2FA</h4>
      <button type="button" class="btn-panel btn-red" id="close-edit-twofa-modal" title="Cerrar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="twofa-edit-form">
      <input type="hidden" id="edit-twofa-config-id" value="">
      
      <label for="edit-twofa-emails-input" class="sr-only">Correos</label>
      <textarea
        id="edit-twofa-emails-input"
        rows="2"
        placeholder="Correos (separados por coma o espacio): correo1@test.com, correo2@test.com"
        required
        class="d-block mb-05 w-100"
        autocomplete="off"
      ></textarea>
      
      <!-- L√≠nea compacta: C√≥digo manual | Subir QR -->
      <div class="d-flex gap-05 align-items-center mb-05 twofa-compact-row">
        <label for="edit-twofa-secret-input" class="sr-only">C√≥digo Secreto</label>
        <input
          type="text"
          id="edit-twofa-secret-input"
          placeholder="C√≥digo secreto"
          class="flex-grow-1"
          autocomplete="off"
          pattern="[A-Z0-9]{16,}"
          title="C√≥digo secreto TOTP (solo letras may√∫sculas y n√∫meros)"
        >
        <label for="edit-twofa-qr-file" class="sr-only">Archivo QR</label>
        <input
          type="file"
          id="edit-twofa-qr-file"
          accept="image/*"
          class="d-none"
        >
        <button type="button" id="edit-twofa-upload-qr-btn" class="btn-blue btn-small">
          <i class="fas fa-qrcode"></i> QR
        </button>
      </div>
      
      <!-- Preview del QR (oculto por defecto) -->
      <div id="edit-twofa-qr-preview" class="text-center mb-05 d-none"></div>
      
      <!-- Display del secreto configurado -->
      <div id="edit-twofa-secret-display" class="mb-05 text-center">
        <strong>Secreto configurado:</strong> <code id="edit-twofa-secret-display-value"></code>
      </div>
      
      <div class="text-center">
        <button type="submit" id="edit-twofa-save-btn" class="btn-green">Actualizar</button>
        <button type="button" id="edit-twofa-cancel-btn" class="btn-blue">Cancelar</button>
      </div>
      
      <div id="edit-twofa-message" class="mt-05 text-center"></div>
    </form>
  </div>
</div>

<!-- Modal para editar configuraci√≥n SMS -->
<div id="sms-edit-config-modal" class="modal d-none" tabindex="-1">
  <div class="sms-modal-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="m-0 text-center flex-grow-1">Editar Configuraci√≥n SMS</h4>
      <button type="button" class="btn-panel btn-red" id="close-edit-config-modal" title="Cerrar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="sms-edit-config-form">
      <input type="hidden" id="edit-sms-config-id" value="">
      <input type="hidden" id="edit-sms-config-type" value=""> <!-- Para detectar si es Android -->
      
      <!-- Campos para Twilio (ocultos si es Android) -->
      <div id="edit-twilio-fields">
        <label for="edit-sms-config-name" class="sr-only">Nombre</label>
        <input
          type="text"
          id="edit-sms-config-name"
          placeholder="Nombre (obligatorio)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <label for="edit-sms-config-account-sid" class="sr-only">Twilio Account SID</label>
        <input
          type="text"
          id="edit-sms-config-account-sid"
          placeholder="Twilio Account SID (obligatorio)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        
        <label for="edit-sms-config-auth-token" class="sr-only">Twilio Auth Token</label>
        <input
          type="password"
          id="edit-sms-config-auth-token"
          placeholder="Twilio Auth Token (opcional, d√©jalo vac√≠o para mantener el actual)"
          class="d-block mb-05"
          autocomplete="off"
        >
      </div>
      
      <!-- Campos para Android (ocultos si es Twilio) -->
      <div id="edit-android-fields" class="d-none">
        <label for="edit-android-config-name" class="sr-only">Nombre</label>
        <input
          type="text"
          id="edit-android-config-name"
          placeholder="Nombre (obligatorio, ej: Mi Celular Principal)"
          required
          class="d-block mb-05"
          autocomplete="off"
        >
        <label for="edit-android-phone-number" class="sr-only">N√∫mero Android</label>
        <input
          type="text"
          id="edit-android-phone-number"
          placeholder="Tu n√∫mero Android (ej: +573001234567)"
          required
          class="d-block mb-05"
          autocomplete="off"
          pattern="^\+[1-9]\d{1,14}$"
          title="Formato: +573001234567 (con c√≥digo de pa√≠s)"
        >
        
        <label for="edit-android-api-key" class="sr-only">API Key</label>
        <div class="d-flex align-items-center gap-05 mb-05">
          <div class="flex-grow-1 d-flex align-items-center twofa-api-key-container">
            <input
              type="text"
              id="edit-android-api-key"
              placeholder="API Key (opcional, para mayor seguridad)"
              class="flex-grow-1 twofa-api-key-input"
              autocomplete="off"
            >
            <button 
              type="button" 
              id="toggle-edit-api-key-visibility" 
              class="btn-blue btn-small twofa-api-key-toggle" 
              title="Mostrar/Ocultar API Key"
            >
              <i class="fas fa-eye" id="edit-api-key-eye-icon"></i>
            </button>
          </div>
          <button type="button" id="generate-edit-api-key-btn" class="btn-blue btn-small" title="Generar API Key aleatoria">
            <i class="fas fa-key"></i> Generar
          </button>
        </div>
        
        <!-- URL del Webhook para Android -->
        <div class="mb-05 p-1 twofa-info-box">
          <strong>URL del Webhook:</strong>
          <div class="d-flex align-items-center gap-05 mt-05">
            <code id="edit-webhook-url" class="flex-grow-1 twofa-webhook-code">Cargando...</code>
            <button type="button" id="copy-edit-webhook-btn" class="btn-blue btn-small" title="Copiar URL">
              <i class="fas fa-copy"></i> Copiar
            </button>
          </div>
        </div>
      </div>
      
      <!-- Campo com√∫n: N√∫mero de Tel√©fono -->
      <label for="edit-sms-config-phone" class="sr-only">N√∫mero de Tel√©fono</label>
      <input
        type="text"
        id="edit-sms-config-phone"
        placeholder="N√∫mero de Tel√©fono (obligatorio, ej: +12672441170)"
        required
        class="d-block mb-05"
        autocomplete="off"
      >
      
      <div class="mt-3 text-center">
        <button type="submit" id="update-sms-config-btn" class="btn-green">Actualizar</button>
      </div>
      
      <div id="edit-sms-config-message" class="mt-05"></div>
    </form>
  </div>
</div>

<!-- Modal para ver mensaje completo -->
<div id="sms-message-modal" class="modal d-none" tabindex="-1">
  <div class="sms-modal-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="m-0 text-center flex-grow-1">Detalles del Mensaje</h4>
      <button type="button" class="btn-close" id="close-sms-modal"></button>
    </div>
    
    <div id="sms-message-details">
      <!-- Contenido din√°mico -->
    </div>
    
    <div class="mt-3 text-center">
      <button type="button" id="close-sms-modal-btn" class="btn-panel btn-red">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal para gestionar Regex de SMS Config -->
<div id="sms-regex-modal" class="modal d-none" tabindex="-1">
  <div class="sms-modal-content admin-card">
    <div class="d-flex justify-content-between align-items-center mb-1">
      <h4 class="m-0 text-center flex-grow-1">Gestionar Regex para SMS</h4>
      <button type="button" class="btn-panel btn-red" id="close-regex-modal" title="Cerrar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div id="sms-regex-config-name" class="mb-1 text-center font-weight-bold"></div>
    
    <hr class="hr-margin-15">
    
    <!-- Formulario para crear nuevo regex -->
    <div class="mb-2 regex-form-container">
      <label for="new-regex-name" class="sr-only">Nombre del regex</label>
      <input type="text" id="new-regex-name" placeholder="Nombre del regex" class="d-block mb-05 w-100" autocomplete="off">
      <label for="new-regex-pattern" class="sr-only">Patr√≥n regex</label>
      <input type="text" id="new-regex-pattern" placeholder="Patr√≥n regex (ej: c√≥digo|code)" class="d-block mb-05 w-100" autocomplete="off">
      <div class="text-center mt-1">
        <button type="button" id="create-regex-btn" class="btn-green btn-sm">Crear Regex</button>
      </div>
    </div>
    
    <div class="mb-2">
      <div class="mb-05"><strong>Regex disponibles:</strong></div>
      <div id="sms-regex-list" class="mb-2 regex-list-container">
        <p class="text-center text-secondary">Cargando regex...</p>
      </div>
    </div>
    
    <div id="sms-regex-message" class="mt-05"></div>
  </div>
</div>

<!-- Modal para editar Regex -->
<div id="sms-regex-edit-modal" class="modal d-none" tabindex="-1">
  <div class="sms-modal-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="m-0 text-center flex-grow-1">Editar Regex</h4>
      <button type="button" class="btn-panel btn-red" id="close-edit-regex-modal" title="Cerrar">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="edit-regex-form">
      <input type="hidden" id="edit-regex-id" value="">
      
      <label for="edit-regex-name" class="sr-only">Nombre</label>
      <input type="text" id="edit-regex-name" placeholder="Nombre del regex" class="d-block mb-05 w-100" required autocomplete="off">
      
      <label for="edit-regex-pattern" class="sr-only">Patr√≥n</label>
      <input type="text" id="edit-regex-pattern" placeholder="Patr√≥n regex" class="d-block mb-05 w-100" required autocomplete="off">
      
      <div class="text-center mt-2">
        <button type="submit" id="update-regex-btn" class="btn-green">Actualizar</button>
      </div>
      
      <div id="edit-regex-message" class="mt-05"></div>
    </form>
  </div>
</div>
{% endblock %}


