{% extends "base.html" %}

{% block title %}Editar Producto{% endblock %}

{% block head %}{{ super() }}<link rel="stylesheet" href="{{ url_for('store_bp.static', filename='css/store.css') }}">{% endblock %}
{% block content %}
<div class="store-dark maxw-800 mx-auto mt-3 br-8">
  <div class="d-flex align-items-center justify-content-center mb-1">
    <h2 class="m-0">Editar Producto</h2>
  </div>
  <form action="" method="POST" class="d-flex flex-column gap-05 edit-product-form" id="editProductForm">
    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
    <label for="editProductName" class="text-center w-100">Nombre</label>
    <input type="text" name="name" value="{{ product.name }}" required class="edit-product-input" id="editProductName" {% if product.is_preset %}readonly{% endif %} autocomplete="off">
    <label for="editProductPriceCop" class="text-center w-100">Precio COP</label>
    <input type="number" step="1" name="price_cop" value="{{ '%d'|format(product.price_cop) }}" required class="edit-product-input" id="editProductPriceCop" autocomplete="off">
    <label for="editProductPriceUsd" class="text-center w-100">Precio USD</label>
    <input type="number" step="1" name="price_usd" value="{{ '%d'|format(product.price_usd) }}" required class="edit-product-input" id="editProductPriceUsd" autocomplete="off">
    <div class="text-center w-100">Imagen</div>
    <div class="image-select-container edit-product-image-container">
      <div class="grid-overlay" id="imageGridOverlay"></div>
      <label for="imageSelect" class="sr-only">Seleccionar imagen</label>
      <select name="image_filename" id="imageSelect" class="visually-hidden-select edit-product-image-select" autocomplete="off">
        <option value="none" {% if product.image_filename == 'none' %}selected{% endif %}>Ninguno</option>
        {% for img in range(1,33) %}
          <option value="stream{{ img }}.png" {% if product.image_filename == 'stream' ~ img ~ '.png' %}selected{% endif %}>stream{{ img }}.png</option>
        {% endfor %}
      </select>
      <button type="button" id="imageSelectTrigger" class="image-select-trigger-btn edit-product-image-select">Seleccionar Imagen</button>
      <div class="image-grid" id="imageGrid"></div>
    </div>
    <div class="mt-05 edit-product-preview-container">
      <img id="imgPreview" src="{{ url_for('static', filename='images/' + (product.image_filename if product.image_filename and product.image_filename != 'none' else 'stream1.png')) }}" width="90">
    </div>
    <label for="description" class="sr-only">Descripción del producto</label>
    <textarea name="description" id="description" class="textarea-black-border" placeholder="Descripción del producto (opcional)" autocomplete="off">{{ product.description or '' }}</textarea>
    <label class="mt-05 d-flex align-items-center gap-05 text-center w-100">Visible
    <input type="checkbox" name="enabled" {% if product.enabled %}checked{% endif %} autocomplete="off"></label>
    <div class="d-flex gap-1 justify-content-center">
      <a href="{{ url_for('store_bp.admin_productos') }}" class="btn-panel btn-blue">Volver</a>
      <button type="submit" class="btn-panel btn-green">Guardar</button>
    </div>
  </form>
</div>
{% endblock %}
{% block scripts %}{{ super() }}<script src="{{ url_for('store_bp.static', filename='js/admin_store.js') }}" defer></script>{% endblock %} 