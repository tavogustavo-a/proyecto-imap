{% extends "base.html" %}

{% block title %}Roles{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('store_bp.static', filename='css/store.css') }}">
{% endblock %}
{% block content %}
<div class="container container-max-width-900">
  <div class="store-light roles-table-container roles-center">
  <div class="d-flex align-items-center justify-content-between mb-1 roles-header">
    <h2 class="m-0">Roles</h2>
    <a href="{{ url_for('store_bp.admin_store') }}" class="btn-panel btn-blue roles-back-btn">Volver a Tienda</a>
  </div>
  <div class="d-flex flex-wrap align-items-center mb-1 productos-buscar-mostrar">
    <div class="search-container">
      <label for="searchRoleInput" class="sr-only">Buscar rol</label>
      <input id="searchRoleInput" type="search" class="form-control roles-search-input" placeholder="Buscar rol..." autocomplete="off">
    </div>
    <div class="d-flex align-items-center gap-1">
      <label for="showRoleCount" class="sr-only">Mostrar cantidad de roles</label>
      <select id="showRoleCount" autocomplete="off">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50">50</option>
        <option value="100">100</option>
        <option value="all">Todas</option>
      </select>
    </div>
  </div>
    <div class="table-wrapper-store roles-table-wrapper">
      <table class="table mb-2 roles-table" id="roles-table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Descuentos</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="roles-table-body">
          <tr><td colspan="3" class="text-center">No hay roles aún.</td></tr>
        </tbody>
      </table>
    </div>
    <!-- Botones de paginación -->
    <div class="d-flex justify-content-center mt-2 mb-2 pagination-buttons mx-12">
      <button id="prevRolePageBtn" class="btn-blue btn-panel" type="button">&lt; Anterior</button>
      <button id="nextRolePageBtn" class="btn-blue btn-panel" type="button">Siguiente &gt;</button>
    </div>
  </div>
  <div class="store-light roles-table-container roles-create-container roles-center">
    <h3 class="text-center mb-1">Crear Rol</h3>
    <div class="roles-create-container text-center">
      <form id="newRoleForm" class="roles-create-form" method="POST" action="{{ url_for('store_bp.admin_roles') }}">
        <label for="roleName" class="sr-only">Nombre del rol</label>
        <input type="text" id="roleName" name="name" placeholder="Nombre del rol" class="roles-create-input roles-input-wide mx-auto" autocomplete="off">
        <div class="d-flex gap-1 roles-create-discounts justify-center">
          <label for="discountUsdCreate" class="sr-only">Descuento USD</label>
          <input type="number" name="discount_usd" id="discountUsdCreate" placeholder="Descuento USD" required class="roles-create-discount-input roles-input-40 mx-auto" autocomplete="off">
          <label for="discountCopCreate" class="sr-only">Descuento COP</label>
          <input type="number" name="discount_cop" id="discountCopCreate" placeholder="Descuento COP" required class="roles-create-discount-input roles-input-40 mx-auto" autocomplete="off">
        </div>
        <div class="roles-create-discount-container text-center mt-05 mb-05">
          Tipo de precio:
          <label class="mx-05"><input type="radio" name="tipo_precio" value="usd" required checked id="tipoUsdCreate" autocomplete="off"> USD</label>
          <label class="mx-05"><input type="radio" name="tipo_precio" value="cop" required id="tipoCopCreate" autocomplete="off"> COP</label>
        </div>
        <div class="roles-create-price-warning mb-1">
          <small class="text-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Advertencia:</strong> Solo puedes ingresar descuento en la moneda seleccionada. El campo de la otra moneda se desactivará automáticamente.
          </small>
        </div>
        <div class="d-flex justify-content-center mb-1 w-100">
          <button type="button" id="showProductsModal" class="btn-blue btn-panel roles-create-btn">Ver productos</button>
          <input type="hidden" name="products_hidden" id="productsHiddenInput">
        </div>
        <button type="submit" class="btn-panel btn-green mb-1 mx-auto d-block">Crear Rol</button>
      </form>
    </div>
  </div>
</div>

<!-- Modal para mostrar productos -->
<div id="productsModal" class="roles-modal">
  <div class="modal-content roles-modal-content">
    <h3>Productos Disponibles</h3>
    <div class="d-flex flex-column gap-03 roles-modal-products-list" id="productsCheckboxList">
      {% for p in products %}
        <label class="d-flex align-items-center gap-03">
          <input type="checkbox" class="product-checkbox" value="{{ p.id }}" name="product_checkbox_{{ p.id }}" checked autocomplete="off">
          <span>{{ p.name }}</span>
        </label>
      {% endfor %}
    </div>
    <div class="d-flex flex-wrap gap-1 justify-content-center mt-1 roles-modal-btns">
      <button type="button" id="selectAllProducts" class="btn-blue btn-panel roles-modal-btn">Agregar todos</button>
      <button type="button" id="deselectAllProducts" class="btn-blue btn-panel roles-modal-btn">Desactivar todos</button>
      <button id="saveProducts" class="btn-green btn-panel roles-modal-btn">Guardar</button>
      <button id="closeModal" class="btn-red btn-panel roles-modal-btn">Cerrar</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('store_bp.static', filename='js/roles.js') }}?v=20241220-fix"></script>
{% endblock %} 